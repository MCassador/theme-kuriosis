{%- if show_language_switcher or show_currency_switcher -%}
	<localization-form class="thb-localization-forms {{ class }}">
	  {%- form 'localization', id: id -%}
		{%- if show_language_switcher -%}
		  {% comment %}
		  <div class="select language-switcher">
			<label for="thb-language-code-{{ id }}" class="visually-hidden">{{ 'localization.update_country' | t }}</label>
			<select id="thb-language-code-{{ id }}" name="locale_code" class="thb-language-code resize-select">
			{%- for language in localization.available_languages -%}
			<option value="{{ language.iso_code }}" {%- if language == localization.language %} selected="selected"{% endif %}>{{- language.endonym_name -}}</option>
			{%- endfor -%}
			</select>
			<div class="select-arrow">{%- render 'svg-icons' with 'thb-select' -%}</div>
		  </div>
		  {% endcomment %}
		  <div class="select language-switcher">
			<label for="thb-language-code-{{ id }}" class="visually-hidden">{{ 'localization.update_country' | t }}</label>
			<div class="custom-language-dropdown">
			  <button class="dropdown-btn" type="button">
				{% assign current_language = localization.language.iso_code %}
				{% assign current_flag = current_language | append: '.png' | asset_url %}
				<img src="{{ current_flag }}" width="32px" height="32px" alt="{{ localization.language.endonym_name }} Flag">
				<span>{{ localization.language.endonym_name }}</span>
			  </button>
			  <ul class="dropdown-options">
				{%- for language in localization.available_languages -%}
				  {% assign flag = language.iso_code | append: '.png' | asset_url %}
				  {% if language.iso_code == 'en' %}
					{% assign language_url = '/' %}
				  {% else %}
					{% assign language_url = '/' | append: language.iso_code %}
				  {% endif %}
				  <li data-value="{{ language.iso_code }}" data-href="{{ language_url }}">
					<img src="{{ flag }}" alt="{{ language.endonym_name }} Flag" width="32px" height="32px">
					<span>{{ language.endonym_name }}</span>
				  </li>
				{%- endfor -%}
			  </ul>
			</div>
		  </div>
	
		  <script>
			document.addEventListener('DOMContentLoaded', function () {
			  const dropdowns = document.querySelectorAll('.custom-language-dropdown');
			  
			  // Get current path from the browser.
			  let currentPath = window.location.pathname;
			  // Remove an existing language prefix (if any).
			  let pathParts = currentPath.split('/');
			  if (pathParts[1] && pathParts[1].length === 2) {
				pathParts.splice(1, 1); // remove language code segment
				currentPath = pathParts.join('/') || '/';
			  }
			  
			  dropdowns.forEach(function (dropdown) {
				const dropdownBtn = dropdown.querySelector('.dropdown-btn');
				const optionsList = dropdown.querySelector('.dropdown-options');
				
				// Toggle the dropdown menu.
				dropdownBtn.addEventListener('click', function (event) {
				  event.preventDefault();
				  optionsList.classList.toggle('show');
				  
				  // Close other dropdowns.
				  dropdowns.forEach(function (otherDropdown) {
					if (otherDropdown !== dropdown) {
					  otherDropdown.querySelector('.dropdown-options').classList.remove('show');
					}
				  });
				});
				
				// Update each language option's URL to include the current subpage.
				optionsList.querySelectorAll('li[data-value]').forEach(function(li) {
				  const langCode = li.getAttribute('data-value');
				  // For the default language (English), no prefix is added.
				  if (langCode === 'en') {
					li.setAttribute('data-href', currentPath);
				  } else {
					li.setAttribute('data-href', '/' + langCode + currentPath);
				  }
				});
				
				// Handle option selection and language change.
				optionsList.addEventListener('click', function (event) {
				  const clickedOption = event.target.closest('li[data-value]');
				  if (clickedOption) {
					const selectedLanguageUrl = clickedOption.dataset.href;
					if (selectedLanguageUrl) {
					  window.location.href = selectedLanguageUrl;
					}
				  }
				});
			  });
			  
			  // Close dropdowns when clicking outside.
			  document.addEventListener('click', function (event) {
				dropdowns.forEach(function (dropdown) {
				  if (!event.target.closest('.custom-language-dropdown')) {
					dropdown.querySelector('.dropdown-options').classList.remove('show');
				  }
				});
			  });
			});
		  </script>
		{%- endif -%}
		{%- if show_currency_switcher -%}
		  <div class="select">
			<label for="thb-currency-code-{{ id }}" class="visually-hidden">{{ 'localization.update_country' | t }}</label>
			<select id="thb-currency-code-{{ id }}" name="country_code" class="thb-currency-code resize-select">
			  {%- for country in localization.available_countries -%}
				<option value="{{ country.iso_code }}" {%- if country.iso_code == localization.country.iso_code %} selected="selected"{% endif %}>{{ country.name }} ({{ country.currency.iso_code }} {{ country.currency.symbol }})</option>
			  {%- endfor -%}
			</select>
			<div class="select-arrow">{%- render 'svg-icons' with 'thb-select' -%}</div>
		  </div>
		{%- endif -%}
		<noscript>
		  <button class="text-button">{{ 'localization.update_country' | t }}</button>
		</noscript>
	  {%- endform -%}
	</localization-form>
	<script src="{{ 'localization.js' | asset_url }}" defer="defer"></script>
	{%- endif -%}